{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "card-overlap-scroll",
  "type": "registry:component",
  "description": "basically a card but it",
  "files": [
    {
      "path": "labs-registry/components-v1/card-overlap-scroll.tsx",
      "content": "\"use client\";\r\n\r\nimport { useRef, useState, useEffect } from \"react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport {\r\n  Card,\r\n  CardHeader,\r\n  CardTitle,\r\n  CardDescription,\r\n} from \"@/components/ui/card\";\r\nimport { useScroll } from \"@/labs-registry/components-v1/functions/hooks/use-scroll\";\r\nimport {\r\n  clamp,\r\n  mapRange,\r\n} from \"@/labs-registry/components-v1/functions/lib/maths\";\r\n\r\ninterface RequirementCard {\r\n  description: string | React.ReactNode;\r\n  number?: number;\r\n}\r\n\r\nconst defaultCards: RequirementCard[] = [\r\n  {\r\n    description: \"Your project must be open-source, original, and unique.\",\r\n  },\r\n  {\r\n    description: \"Track your progress with Hackatime while building.\",\r\n  },\r\n  {\r\n    description:\r\n      \"The project must involved with your webcam or your phone camera.\",\r\n  },\r\n  {\r\n    description: \"You must code at least 30 hours on your project.\",\r\n  },\r\n  {\r\n    description: \"Last thing, add a README to your project repository ðŸ˜­\",\r\n  },\r\n];\r\n\r\ninterface RequirementCardsProps {\r\n  cards?: RequirementCard[];\r\n  className?: string;\r\n}\r\n\r\nexport function RequirementCards({\r\n  cards = defaultCards,\r\n  className,\r\n}: RequirementCardsProps) {\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const cardsContainerRef = useRef<HTMLDivElement>(null);\r\n  const backgroundRef = useRef<HTMLDivElement>(null);\r\n  const [rect, setRect] = useState({ top: 0, height: 0 });\r\n  const [current, setCurrent] = useState(0);\r\n  const [backgroundHeight, setBackgroundHeight] = useState(\"200vh\");\r\n  const [scrollHeight, setScrollHeight] = useState(\"100vh\");\r\n  const [endScrollVh, setEndScrollVh] = useState(0);\r\n\r\n  const parallaxRatio = 0.1;\r\n\r\n  // Calculate scroll height based on cards count and device\r\n  useEffect(() => {\r\n    const calculateScrollHeight = () => {\r\n      const isDesktop = window.innerWidth >= 768;\r\n      // Base scroll per card: desktop short, mobile longer for readability\r\n      const scrollPerCard = isDesktop ? 60 : 120;\r\n      // Add extra scroll at start and end\r\n      const baseScroll = isDesktop ? 80 : 200;\r\n      const endScroll = isDesktop ? 100 : 150;\r\n      setEndScrollVh(endScroll);\r\n      const totalScroll = baseScroll + cards.length * scrollPerCard + endScroll;\r\n      setScrollHeight(`${totalScroll}vh`);\r\n    };\r\n\r\n    calculateScrollHeight();\r\n    window.addEventListener(\"resize\", calculateScrollHeight);\r\n    return () => window.removeEventListener(\"resize\", calculateScrollHeight);\r\n  }, [cards.length]);\r\n\r\n  // biome-ignore lint/correctness/useExhaustiveDependencies: <explanation>\r\n  useEffect(() => {\r\n    const updateRect = () => {\r\n      if (containerRef.current) {\r\n        const boundingRect = containerRef.current.getBoundingClientRect();\r\n        const height = containerRef.current.scrollHeight;\r\n        setRect({\r\n          top: boundingRect.top + window.scrollY,\r\n          height: height,\r\n        });\r\n\r\n        // Calculate background height based on container height and parallax ratio\r\n        const extraHeight = height * parallaxRatio;\r\n        const totalHeight = window.innerHeight + extraHeight;\r\n        setBackgroundHeight(`${totalHeight}px`);\r\n      }\r\n    };\r\n\r\n    updateRect();\r\n    window.addEventListener(\"resize\", updateRect);\r\n    return () => window.removeEventListener(\"resize\", updateRect);\r\n  }, [scrollHeight]); // Re-run when scrollHeight changes\r\n\r\n  useScroll(\r\n    ({ scroll }) => {\r\n      const windowHeight = window.innerHeight;\r\n      const start = rect.top - windowHeight * 2;\r\n      // Subtract endScroll from height so progress reaches 100% before the end padding\r\n      const endScrollPixels = (endScrollVh / 100) * windowHeight;\r\n      const end = rect.top + rect.height - windowHeight - endScrollPixels;\r\n\r\n      const progress = clamp(0, mapRange(start, end, scroll, 0, 1), 1);\r\n\r\n      if (cardsContainerRef.current) {\r\n        const clampedProgress = clamp(\r\n          0,\r\n          mapRange(rect.top, end, scroll, 0, 1),\r\n          1,\r\n        );\r\n        cardsContainerRef.current.style.setProperty(\r\n          \"--progress\",\r\n          clampedProgress.toString(),\r\n        );\r\n      }\r\n\r\n      if (backgroundRef.current && containerRef.current) {\r\n        const containerTop = rect.top;\r\n        const relativeScroll = scroll - containerTop;\r\n        const parallaxOffset = relativeScroll * -parallaxRatio;\r\n        backgroundRef.current.style.transform = `translateY(${parallaxOffset}px)`;\r\n      }\r\n\r\n      const step = Math.floor(progress * cards.length);\r\n      setCurrent(step);\r\n    },\r\n    [rect, cards.length],\r\n  );\r\n\r\n  return (\r\n    <div\r\n      ref={containerRef}\r\n      className={cn(\"relative\", className)}\r\n      style={{ minHeight: scrollHeight }}\r\n    >\r\n      <div className=\"sticky top-0 h-screen overflow-hidden p-4 md:p-8\">\r\n        {/* Parallax Background */}\r\n        <div\r\n          ref={backgroundRef}\r\n          className=\"pointer-events-none absolute inset-0 bg-[linear-gradient(to_right,#80808033_1px,transparent_1px),linear-gradient(to_bottom,#80808033_1px,transparent_1px)] bg-position-[center_center] bg-size-[70px_70px] will-change-transform\"\r\n          style={{ height: backgroundHeight }}\r\n        >\r\n          <div className=\"absolute top-0 right-0 left-0 h-[15vh] w-full bg-linear-to-b from-background to-transparent\" />\r\n          <div className=\"absolute right-0 bottom-0 left-0 h-[30vh] w-full bg-linear-to-t from-background to-transparent\" />\r\n        </div>\r\n        <div className=\"relative h-full\">\r\n          <aside className=\"mb-8 text-right md:absolute md:top-0 md:right-0\">\r\n            <h2 className=\"font-bold text-xl sm:text-4xl xl:text-5xl 2xl:text-6xl\">\r\n              Follow the <i>requirement</i> first,\r\n              <br />\r\n              <span className=\"text-foreground/70\">\r\n                Then ship your <i>project</i>.\r\n              </span>\r\n            </h2>\r\n          </aside>\r\n\r\n          <div\r\n            ref={cardsContainerRef}\r\n            className=\"relative h-full pt-24 md:pt-0\"\r\n          >\r\n            {cards.map((card, index) => (\r\n              <SingleCard\r\n                // biome-ignore lint/suspicious/noArrayIndexKey: <explanation>\r\n                key={index}\r\n                index={index}\r\n                description={card.description}\r\n                number={card.number || index + 1}\r\n                current={index <= current - 1}\r\n                totalCards={cards.length}\r\n              />\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface SingleCardProps {\r\n  description?: string | React.ReactNode;\r\n  number: number;\r\n  index: number;\r\n  current: boolean;\r\n  totalCards: number;\r\n}\r\n\r\nfunction SingleCard({\r\n  description,\r\n  number,\r\n  index,\r\n  current,\r\n  totalCards,\r\n}: SingleCardProps) {\r\n  const [position, setPosition] = useState({ top: \"0px\", left: \"0\" });\r\n  const [isMounted, setIsMounted] = useState(false);\r\n\r\n  useEffect(() => {\r\n    setIsMounted(true);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!isMounted) return;\r\n\r\n    const getCardPosition = () => {\r\n      // Calculate available space (screen height/width minus card size and padding)\r\n      const cardHeight = window.innerWidth >= 768 ? 320 : 200; // 20rem = 320px\r\n      const cardWidth = window.innerWidth >= 768 ? 480 : 280; // 30rem = 480px\r\n      const padding = window.innerWidth >= 768 ? 64 : 32; // Account for container padding\r\n\r\n      // On mobile, use a percentage-based approach to distribute cards more evenly\r\n      const availableHeight =\r\n        window.innerWidth >= 768\r\n          ? window.innerHeight - cardHeight - padding * 2\r\n          : window.innerHeight * 0.4;\r\n      const availableWidth = window.innerWidth - cardWidth - padding * 2;\r\n\r\n      // Calculate spacing between cards\r\n      const spacingTop =\r\n        totalCards > 1 ? availableHeight / (totalCards - 1) : 0;\r\n      const spacingLeft =\r\n        totalCards > 1 ? availableWidth / (totalCards - 1) : 0;\r\n\r\n      return {\r\n        top: `${Math.max(0, Math.min(index * spacingTop, availableHeight))}px`,\r\n        left:\r\n          window.innerWidth >= 768\r\n            ? `${Math.max(0, Math.min(index * spacingLeft, availableWidth))}px`\r\n            : \"0\",\r\n      };\r\n    };\r\n\r\n    const updatePosition = () => {\r\n      setPosition(getCardPosition());\r\n    };\r\n\r\n    updatePosition();\r\n    window.addEventListener(\"resize\", updatePosition);\r\n    return () => window.removeEventListener(\"resize\", updatePosition);\r\n  }, [isMounted, index, totalCards]);\r\n\r\n  return (\r\n    <div\r\n      className={cn(\r\n        \"-translate-x-1/2 absolute left-1/2 backdrop-blur-sm transition-all duration-1000 ease-out md:left-0 md:translate-x-0\",\r\n        current ? \"translate-y-0 opacity-100\" : \"translate-y-full opacity-0\",\r\n      )}\r\n      style={{\r\n        top: position.top,\r\n        left: isMounted && window.innerWidth >= 768 ? position.left : undefined,\r\n      }}\r\n    >\r\n      <Card className=\"relative h-[200px] w-[280px] overflow-hidden bg-background/30 md:h-[20rem] md:w-[30rem]\">\r\n        <CardHeader className=\"h-full\">\r\n          <CardTitle className=\"font-mono font-semibold text-3xl text-main/50 md:text-7xl\">\r\n            0{index + 1}\r\n          </CardTitle>\r\n          <CardDescription className=\"line-clamp-3 text-sm md:text-xl\">\r\n            {description}\r\n          </CardDescription>\r\n        </CardHeader>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n",
      "type": "registry:component"
    },
    {
      "path": "labs-registry/components-v1/lib/use-scroll.ts",
      "content": "import { useEffect } from \"react\";\r\n\r\nexport function useScroll(\r\n  callback: (data: {\r\n    scroll: number;\r\n    limit: number;\r\n    velocity: number;\r\n    direction: number;\r\n    progress: number;\r\n  }) => void,\r\n  deps: React.DependencyList = [],\r\n) {\r\n  useEffect(() => {\r\n    const handleScroll = () => {\r\n      const scroll = window.scrollY;\r\n      const limit = document.documentElement.scrollHeight - window.innerHeight;\r\n      const progress = limit > 0 ? scroll / limit : 0;\r\n\r\n      callback({\r\n        scroll,\r\n        limit,\r\n        velocity: 0, // simplified version\r\n        direction: 0, // simplified version\r\n        progress,\r\n      });\r\n    };\r\n\r\n    window.addEventListener(\"scroll\", handleScroll);\r\n    handleScroll(); // Initial call\r\n\r\n    return () => {\r\n      window.removeEventListener(\"scroll\", handleScroll);\r\n    };\r\n  }, [callback, ...deps]);\r\n}\r\n",
      "type": "registry:lib"
    },
    {
      "path": "labs-registry/components-v1/lib/maths.ts",
      "content": "export function clamp(min: number, input: number, max: number): number {\r\n  return Math.max(min, Math.min(input, max));\r\n}\r\n\r\nexport function mapRange(\r\n  in_min: number,\r\n  in_max: number,\r\n  input: number,\r\n  out_min: number,\r\n  out_max: number,\r\n): number {\r\n  return ((input - in_min) * (out_max - out_min)) / (in_max - in_min) + out_min;\r\n}\r\n\r\nexport function lerp(x: number, y: number, t: number): number {\r\n  return (1 - t) * x + t * y;\r\n}\r\n\r\nexport function truncate(value: number, decimals: number): number {\r\n  return parseFloat(value.toFixed(decimals));\r\n}\r\n",
      "type": "registry:lib"
    }
  ]
}